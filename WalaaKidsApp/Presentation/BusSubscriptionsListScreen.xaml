<UserControl x:Class="WalaaKidsApp.Presentation.BusSubscriptionsListScreen"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WalaaKidsApp.Presentation"
             xmlns:icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
             mc:Ignorable="d" 
             x:Name="BusSubscriptionListUserControl"
            FlowDirection="RightToLeft"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Background="Transparent"
            Opacity="0"
            d:Opacity="1"
            d:DesignWidth="800" d:DesignHeight="800"
            d:Background="#eff2f7"
             Loaded="BusSubscriptionListUserControl_Loaded"
>
    <UserControl.Resources>
        <Storyboard x:Key="FadeInStoryboard">
            <DoubleAnimation 
             Storyboard.TargetProperty="Opacity"
             Storyboard.TargetName="BusSubscriptionListUserControl"
             From="0" To="1"
             Duration="0:0:0.4" />
        </Storyboard>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <Border BorderThickness="0 0 0 2">
            <Border.BorderBrush>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#662D8C" Offset="1"/>
                    <GradientStop Color="#ED1E79" Offset=".1"/>
                </LinearGradientBrush>
            </Border.BorderBrush>
            <Grid 
                 HorizontalAlignment="Center"
                 VerticalAlignment="Top"
                 Grid.Row="0"
                 Width="270"
      >
                <TextBlock FontWeight="SemiBold" 
                    Text="بحث :"
                    VerticalAlignment="Center"
             />
                <TextBox x:Name="KeywordTextBox" Width="200" Height="35" Padding="10 8 30 0" 
                         d:Text="زين على جمال على محمد فرغلى" KeyDown="KeywordTextBox_KeyDown"/>

                <Button Name="SearchButton" Click="SearchButton_Click"
                        Style="{StaticResource SearchButton}" HorizontalAlignment="Right" Margin="0 0 40 0">
                    <icon:PackIconMaterial Kind="Magnify" Width="25" Height="20">
                        <icon:PackIconMaterial.Foreground>
                            <LinearGradientBrush>
                                <GradientStop Color="#662D8C" Offset="1"/>
                                <GradientStop Color="#ED1E79" Offset=".1"/>
                            </LinearGradientBrush>
                        </icon:PackIconMaterial.Foreground>
                    </icon:PackIconMaterial>
                </Button>
            </Grid>
        </Border>
        <GroupBox BorderThickness="2" Margin="0 10 0 0" Grid.Row="1" Header="قائمة الاشتراكات" FontSize="15">
            <GroupBox.BorderBrush>
                <LinearGradientBrush>
                    <GradientStop Color="#662D8C" Offset="1"/>
                    <GradientStop Color="#ED1E79" Offset=".1"/>
                </LinearGradientBrush>
            </GroupBox.BorderBrush>
            <Grid>
               
                <ListView x:Name="BusSubscriptionsList" 
                          Height="200" 
                          Margin="10" 
                          HorizontalAlignment="Stretch" 
                          VerticalAlignment="Top"
                          ItemsSource="{Binding BusSubscriptions}" 
                          HorizontalContentAlignment="Center"
                          SelectedItem="{Binding SelectedSubscription}">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="اسم الطالب" Width="auto" DisplayMemberBinding="{Binding Student.Name}"/>
                            <GridViewColumn Header="الفصل" Width="auto">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Ellipse Width="20" Height="20" Fill="{Binding Student.Classroom.ColorBrush}"/>
                                        </Grid>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="تاريخ الاشتراك" Width="auto" DisplayMemberBinding="{Binding LocalSubscriptionDateOnly}"/>
                            <GridViewColumn Header="تاريخ الانتهاء" Width="auto" DisplayMemberBinding="{Binding LocalExpiryDateOnly}"/>
                            <GridViewColumn Header="حالة الاشتراك" Width="auto">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid  x:Name="CheckMark" VerticalAlignment="Center">
                                            <Ellipse Name="Circle" HorizontalAlignment="Center" Width="20" Height="20"/>
                                            <TextBlock Name="MarkBlock" FontSize="15" Foreground="White"
                                                       HorizontalAlignment="Center"/>
                                        </Grid>
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding IsValid}" Value="true">
                                                <Setter TargetName="Circle" Property="Fill" Value="Green"/>
                                                <Setter TargetName="MarkBlock" Property="Text" Value="✔"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsValid}" Value="false">
                                                <Setter TargetName="Circle" Property="Fill" Value="Red"/>
                                                <Setter TargetName="MarkBlock" Property="Text" Value="X"/>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
               
            </Grid>
        </GroupBox>
        <StackPanel Orientation="Horizontal" Grid.Row="2">
            <Button x:Name="RenewButton" Style="{StaticResource ContentButton}"
             Content="تجديد - تعديل" Click="RenewButton_Click"/>
            <Button x:Name="CancelSubscriptionButton" 
                    Margin="10 0 0 0" 
                    Style="{StaticResource ContentButton}"
                    Content="الغاء الاشتراك" Click="CancelSubscriptionButton_Click"/>
        </StackPanel>
    </Grid>
</UserControl>
